{extend name="adminPublic:public"/} {block name="title"}公告管理{/block} {block name="content"}
<div class="mws-panel grid_8">
    <div class="mws-panel-header">
        <span>
            <i class="icon-table"></i> 公告管理</span>
    </div>
    <div class="mws-panel-body no-padding">
        <div id="DataTables_Table_1_wrapper" class="dataTables_wrapper" role="grid">
            <div id="DataTables_Table_1_length" class="dataTables_length">
                <label>Show
                    <select size="1" name="DataTables_Table_1_length" aria-controls="DataTables_Table_1">
                        <option value="10" selected="selected">10</option>
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select> entries</label>
            </div>
            <div class="dataTables_filter" id="DataTables_Table_1_filter">
                <label>Search:
                    <input aria-controls="DataTables_Table_1" type="text">
                </label>
            </div>
            <div id="show_table">
                <table class="mws-datatable-fn mws-table dataTable" id="DataTables_Table_1" aria-describedby="DataTables_Table_1_info">
                    <thead>
                        <tr role="row">
                            <th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" style="width: 50.2px;"
                                aria-label="Browser: activate to sort column ascending">选择</th>

                            <th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" style="width: 251.2px;"
                                aria-label="Browser: activate to sort column ascending">公告编码</th>

                            <th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" style="width: 251.2px;"
                                aria-label="Browser: activate to sort column ascending">公告名称</th>

                            <th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" style="width: 234.2px;"
                                aria-label="Platform(s): activate to sort column ascending">公共内容</th>
                            <th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" style="width: 160.2px;"
                                aria-label="Engine version: activate to sort column ascending">公告图片</th>
                            <th class="sorting" role="columnheader" tabindex="0" aria-controls="DataTables_Table_1" rowspan="1" colspan="1" style="width: 118px;"
                                aria-label="CSS grade: activate to sort column ascending">操作</th>
                        </tr>
                    </thead>

                    <tbody role="alert" aria-live="polite" aria-relevant="all">
                        {foreach name='data' item='vo'}
                        <tr class="odd">
                            <td class="  sorting_1">
                                <input type="checkbox" value="{$vo['id']}">
                            </td>
                            <td class=" ">{$vo['id']}</td>
                            <td class=" ">{$vo['name']}</td>
                            <td class=" ">{$vo['describe']}</td>
                            <td class=" ">
                                {if isset($vo['pic'])}
                                <img src="{$vo['pic']}" alt="">
                                {else if}暂缺 {/if}
                            </td>
                            <td class=" ">
                                <a href="" class="btn btn-info">修改</a>
                            </td>
                        </tr>
                        {/foreach}
                       
                    </tbody>
                </table>
            </div>
            <div>
            <div class="dataTables_info" id="DataTables_Table_1_info">
                <a href="javascript:;" class="btn btn-info achoose">全选</a>
                <a href="javascript:;" class="btn btn-info nochoose">全不选</a>
                <a href="javascript:;" class="btn btn-info fchoose">反选</a>
                <a href="javascript:;" class="btn btn-danger del" id="del">删除</a>
            </div>
            </div>
            <div class="dataTables_paginate paging_full_numbers" id="DataTables_Table_1_paginate">
                <a tabindex="0" class="first paginate_button " id="DataTables_Table_1_first">首页</a>
                <a tabindex="0" class="previous paginate_button " id="DataTables_Table_1_previous">上一页</a>
                <span>
                    {foreach name="num" item="vo"}
                    <a tabindex="0" class="paginate_active btn btn-info pages_change" onclick="cpage({$vo})">{$vo}</a>
                    {/foreach}
                </span>
                <a tabindex="0" class="next paginate_button" id="DataTables_Table_1_next">下一页</a>
                <a tabindex="0" class="last paginate_button" id="DataTables_Table_1_last">尾页</a>
            </div>
        </div>
    </div>
</div>
{/block}
{block name="script"}
<script>
    function cpage(n) {
        // $.get("/announce/index", { page: n }, function (data) {
        //     // console.log(data);
        //     $("#show_table").html(data);
        // });
        $.ajax({
            url: '/announce/index',
            data: { 'page': n },
            success: function (data) {
                $("#show_table").html(data);
            }
        });
    }

    // 全选 反选 全不选
    $(".achoose").click(function () {
        // alert(1);
        $(':checkbox').attr('checked', true);
    })

    $('.nochoose').click(function () {
        // alert('no');
        $(':checkbox').attr('checked', false);
    })

    $('.fchoose').click(function () {
        // alert(3);
        $('#show_table').find("tr").each(function () {
            if ($(this).find(':checkbox').attr('checked')) {
                $(this).find(':checkbox').attr('checked', false);
            } else {
                $(this).find(':checkbox').attr('checked', true);
            }
        })

    });


</script>
<script>
    var  ids=[];
    $('.del').click(function () {
        $(':checkbox').each(function () {
            if ($(this).attr('checked')) {
                id=$(this).val();
                console.log(id);
                ids.push(id);
            }

        })
        console.log(ids);
   
        $.ajax({
            url: '/announce/del',
            type: 'get',
            data: { 'ids': ids },
            success: function (data) {
                if (data == 1) {
                    alert('删除成功');
                    for (var i = 0; i < ids.length; i++) {
                            $("input[value=" + ids[i] + "]").parents("tr").remove();
                        }
                } else {
                    alert(data);
                }
            }
        })
    })
</script>
{/block}